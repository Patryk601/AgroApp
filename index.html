<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AgroApp Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <style>
    #map { height: 400px; }
    .form-container { margin-top: 10px; }
  </style>
</head>
<body>

<h1>Dodaj pole</h1>
<div id="map"></div>

<div class="form-container">
  <input type="text" id="nazwa_pola" placeholder="Nazwa pola"><br>
  <input type="text" id="miejscowosc" placeholder="Miejscowość"><br>
  <input type="text" id="rodzaj_uprawy" placeholder="Rodzaj uprawy"><br>
  <input type="color" id="color" value="#3388ff"><br>
  <button onclick="saveField()">Zapisz pole</button>
</div>

<script>
// Firebase config (uzupełniony na podstawie Twoich danych)
const firebaseConfig = {
  apiKey: "AlzaSyD1AE1kvvuqVwpcfHdagXUL79Zr3J951hA",
  authDomain: "agroapp-1d397.firebaseapp.com",
  projectId: "agroapp-1d397",
  storageBucket: "agroapp-1d397.appspot.com",
  messagingSenderId: "683118014918",
  appId: "1:683118014918:web:ab3ae19ec1b521b2f142c7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Leaflet mapa
const map = L.map('map').setView([51.25, 22.57], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

let drawnCoords = [];

map.on('click', function(e) {
  drawnCoords.push([e.latlng.lat, e.latlng.lng]);
  L.marker(e.latlng).addTo(map);
});

function saveField() {
  const nazwa_pola = document.getElementById('nazwa_pola').value;
  const miejscowosc = document.getElementById('miejscowosc').value;
  const rodzaj_uprawy = document.getElementById('rodzaj_uprawy').value;
  const color = document.getElementById('color').value;
  const powierzchnia = (Math.random() * 100).toFixed(2); // przykładowa wartość powierzchni

  if (drawnCoords.length < 3) {
    alert('Narysuj przynajmniej 3 punkty!');
    return;
  }

  db.collection('fields').add({
    nazwa_pola: nazwa_pola,
    miejscowosc: miejscowosc,
    rodzaj_uprawy: rodzaj_uprawy,
    powierzchnia: powierzchnia,
    color: color,
    coordinates: drawnCoords.map(c => ({ lat: c[0], lng: c[1] })),
    userid: firebase.auth().currentUser ? firebase.auth().currentUser.uid : "anonimowy"
  }).then(() => {
    alert('Pole zapisane!');
    drawnCoords = [];
    location.reload();
  }).catch(err => {
    console.error('Błąd przy zapisie:', err);
  });
}
</script>
</body>
</html>
